var e=Object.defineProperty,t=Object.defineProperties;var r=Object.getOwnPropertyDescriptors;var n=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;var K=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,s=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&K(e,r,t[r]);if(n)for(var r of n(t))a.call(t,r)&&K(e,r,t[r]);return e},p=(e,n)=>t(e,r(n));var i="TurboBoost-Command",d={boost:"text/vnd.turbo-boost.html",stream:"text/vnd.turbo-stream.html",html:"text/html",xhtml:"application/xhtml+xml",json:"application/json"},ht=(e={})=>{e=s({},e);let t=(e.Accept||"").split(",").map((e=>e.trim())).filter((e=>e.length));return t.unshift(d.boost,d.stream,d.html,d.xhtml),e.Accept=[...new Set(t)].join(", "),e["Content-Type"]=d.json,e["X-Requested-With"]="XMLHttpRequest",e},vt=e=>{if(e){let[t,r,n]=e.split(", ");return{name:t,status:r,strategy:n}}return{}},l={prepare:ht,tokenize:vt,RESPONSE_HEADER:i};var yt=e=>{document.body.insertAdjacentHTML("beforeend",e)},Et=e=>{var t,r,n,o;let a=(new DOMParser).parseFromString(e,"text/html"),i=document.querySelector("head"),d=document.querySelector("body"),l=a.querySelector("head"),m=a.querySelector("body");i&&l&&((r=(t=TurboBoost==null?void 0:TurboBoost.Streams)==null?void 0:t.morph)==null||r.method(i,l)),d&&m&&((o=(n=TurboBoost==null?void 0:TurboBoost.Streams)==null?void 0:n.morph)==null||o.method(d,m))},w=(e,t)=>{if(e&&t){if(e.match(/^Append$/i))return yt(t);if(e.match(/^Replace$/i))return Et(t)}};var m={};addEventListener("turbo:before-fetch-response",(e=>{let t=e.target.closest("turbo-frame");t!=null&&t.id&&t!=null&&t.src&&(m[t.id]=t.src);let{fetchResponse:r}=e.detail,n=r.header(l.RESPONSE_HEADER);if(!n)return;e.preventDefault();let{strategy:o}=l.tokenize(n);r.responseHTML.then((e=>w(o,e)))}));addEventListener("turbo:frame-load",(e=>{let t=e.target.closest("turbo-frame");t.dataset.src=m[t.id]||t.src||t.dataset.src,delete m[t.id]}));var c={frameAttribute:"data-turbo-frame",methodAttribute:"data-turbo-method",commandAttribute:"data-turbo-command",confirmAttribute:"data-turbo-confirm",stateAttributesAttribute:"data-turbo-boost-state-attributes"},f=s({},c);var b={start:"turbo-boost:command:start",success:"turbo-boost:command:success",finish:"turbo-boost:command:finish",abort:"turbo-boost:command:abort",clientError:"turbo-boost:command:client-error",serverError:"turbo-boost:command:server-error"},v={stateChange:"turbo-boost:state:change",stateInitialize:"turbo-boost:state:initialize"};function u(e,t,r={}){return new Promise((n=>{r=r||{},r.detail=r.detail||{},t=t||document;let o=new CustomEvent(e,p(s({},r),{bubbles:!0}));t.dispatchEvent(o),n(o)}))}var g={};function St(e){g[e.id]=e}function xt(e){delete g[e]}var h={add:St,remove:xt,get commands(){return[...Object.values(g)]},get length(){return Object.keys(g).length}};var y={method:e=>Promise.resolve(confirm(e))},kt=e=>e.detail.driver==="method",Ct=e=>{if(e.detail.driver!=="form")return!1;let t=e.target,r=t.closest("turbo-frame"),n=t.closest(`[${f.frameAttribute}]`);return!!(r||n)},wt=e=>kt(e)||Ct(e);document.addEventListener(b.start,(async e=>{let t=e.target.getAttribute(f.confirmAttribute);t&&(e.detail.confirmation=!0,!wt(e))&&(await y.method(t)||e.preventDefault())}));var A=y;var E,S=[];function Lt(e,t){let r=S.find((t=>t.name===e));return r&&S.splice(S.indexOf(r),1),S=[{name:e,selectors:t},...S],document.removeEventListener(e,E,!0),document.addEventListener(e,E,!0),s({},S.find((t=>t.name===e)))}function Ot(e){return S.find((t=>t.selectors.find((t=>Array.from(document.querySelectorAll(t)).find((t=>t===e))))))}function Tt(e,t){let r=Ot(t);return r&&r.name===e}var O={register:Lt,isRegisteredForElement:Tt,get events(){return[...S]},set handler(e){E=e}};function Rt(e){return e.closest(`[${f.commandAttribute}]`)}function Pt(e){return e.closest("turbo-frame[src]")||e.closest("turbo-frame[data-turbo-frame-src]")||e.closest("turbo-frame")}function $t(e,t={}){if(e.tagName.toLowerCase()!=="select")return t.value=e.value||null;if(!e.multiple)return t.value=e.options[e.selectedIndex].value;t.values=Array.from(e.options).reduce(((e,t)=>(t.selected&&e.push(t.value),e)),[])}function _t(e){let t=Array.from(e.attributes).reduce(((e,t)=>{let r=t.value;return e[t.name]=r,e}),{});return t.tag=e.tagName,t.checked=!!e.checked,t.disabled=!!e.disabled,$t(e,t),delete t.class,delete t.action,delete t.href,delete t[f.commandAttribute],delete t[f.frameAttribute],t}var C={buildAttributePayload:_t,findClosestCommand:Rt,findClosestFrameWithSource:Pt};var Dt=(e,t={})=>{let r=e.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");r.type="hidden",r.name="turbo_boost_command",r.value=JSON.stringify(t),e.contains(r)||e.appendChild(r)},k={invokeCommand:Dt};function Nt(e){setTimeout((()=>u(b.finish,e.target,{detail:e.detail})))}var j=[b.abort,b.serverError,b.success];j.forEach((e=>addEventListener(e,Nt)));addEventListener(b.finish,(e=>h.remove(e.detail.id)),!0);var L={events:b};var It=e=>{let t=document.createElement("a");return t.href=e,new URL(t)},P={get commandInvocationURL(){return It("/turbo-boost-command-invocation")}};var et=e=>{let t=`Unexpected error performing a TurboBoost Command! ${e.message}`;u(L.events.clientError,document,{detail:{message:t,error:e}},!0)},jt=e=>{let{strategy:t}=l.tokenize(e.headers.get(l.RESPONSE_HEADER));e.text().then((e=>w(t,e)))},T=(e={})=>{try{fetch(P.commandInvocationURL.href,{method:"POST",headers:l.prepare({}),body:JSON.stringify(e)}).then(jt).catch(et)}catch(e){et(e)}};var qt=(e,t)=>T(t),N={invokeCommand:qt};var R,_,zt=()=>{R=null,_=null},Ft=(e,t={})=>{R=e,_=t},Ht=e=>{try{if(!R||e.getAttribute("method")!==R.dataset.turboMethod||e.getAttribute("action")!==R.href)return;let t=e.querySelector('input[name="turbo_boost_command"]')||document.createElement("input");t.type="hidden",t.name="turbo_boost_command",t.value=JSON.stringify(_),e.contains(t)||e.appendChild(t)}finally{zt()}};document.addEventListener("submit",(e=>Ht(e.target)),!0);var x={invokeCommand:Ft};var Jt=(e,t={})=>T(t),B={invokeCommand:Jt};function z(e,t){return t=t||{dataset:{}},e.href||t.src||t.dataset.src||location.href}function Mt(e){let t=C.findClosestFrameWithSource(e),{turboFrame:r,turboMethod:n}=e.dataset;return e.tagName.toLowerCase()==="form"?{name:"form",reason:"Element is a form.",frame:t,src:e.action,invokeCommand:k.invokeCommand}:n!=null&&n.length?{name:"method",reason:"Element defines data-turbo-method.",frame:t,src:e.href,invokeCommand:x.invokeCommand}:r&&r!=="_self"?(t=document.getElementById(r),{name:"frame",reason:"element targets a frame that is not _self",frame:t,src:z(e,t),invokeCommand:N.invokeCommand}):r&&r!=="_self"||!t?{name:"window",reason:"element matches one or more of the following conditions (targets _top, does NOT target a frame, is NOT contained by a frame)",frame:null,src:z(e),invokeCommand:B.invokeCommand}:{name:"frame",reason:"element does NOT target a frame or targets _self and is contained by a frame",frame:t,src:z(e,t),invokeCommand:N.invokeCommand}}var I={find:Mt};var D="unknown",q=!1,M=[],J={debug:Object.values(b),info:Object.values(b),warn:[b.abort,b.clientError,b.serverError],error:[b.clientError,b.serverError],unknown:[]},Ut=e=>{if(!J[D].includes(e.type)||typeof console[D]!="function")return!1;let{detail:t}=e;if(!t.id)return!0;let r=`${e.type}-${t.id}`;return!M.includes(r)&&(M.length>16&&M.shift(),M.push(r),!0)},Vt=e=>J.error.includes(e.type)?"error":J.warn.includes(e.type)?"warn":J.info.includes(e.type)?"info":J.debug.includes(e.type)?"debug":"log",Wt=e=>{if(Ut(e)){let{target:t,type:r,detail:n}=e,o=n.id||"",a=n.name||"",i="";n.startedAt&&(i=Date.now()-n.startedAt+"ms ");let d=r.split(":"),l=d.pop(),m=`%c${d.join(":")}:%c${l}`,c=[`%c${a}`,`%c${i}`,m];console[Vt(e)](c.join(" ").replace(/\s{2,}/g," "),"color:deepskyblue","color:lime","color:darkgray",m.match(/abort|error/i)?"color:red":"color:deepskyblue",{id:o,detail:n,target:t})}};q||(q=!0,Object.values(b).forEach((e=>addEventListener(e,(e=>Wt(e))))));var F={get level(){return D},set level(e){return Object.keys(J).includes(e)||(e="unknown"),D=e}};var H;function $(e,t=null){if(!e||typeof e!="object")return e;let r=new Proxy(e,{deleteProperty(e,t){return delete e[t],u(v.stateChange,document,{detail:{state:H}}),!0},set(e,t,r,n){return e[t]=$(r,this),u(v.stateChange,document,{detail:{state:H}}),!0}});if(Array.isArray(e))e.forEach(((t,n)=>e[n]=$(t,r)));else if(typeof e=="object")for(let[t,n]of Object.entries(e))e[t]=$(n,r);return t||(H=r),r}var U=$;var st=(e,t,r,n=1)=>{if(n>20)return;let o=document.getElementById(e);if(o!=null&&o.isConnected)return o.setAttribute(t,r);setTimeout((()=>st(e,t,r,n+1)),n*5)},Xt=()=>Array.from(document.querySelectorAll(`[id][${f.stateAttributesAttribute}]`)).reduce(((e,t)=>{let r=JSON.parse(t.getAttribute(f.stateAttributesAttribute));if(t.id){let n=r.reduce(((e,r)=>(t.hasAttribute(r)&&(e[r]=t.getAttribute(r)||r),e)),{});Object.values(n).length&&(e[t.id]=n)}return e}),{}),Kt=(e={})=>{for(let[t,r]of Object.entries(e))for(let[e,n]of Object.entries(r))st(t,e,n)},G={buildState:Xt,restoreState:Kt};function Gt(e,t){return typeof t!="object"&&(t={}),localStorage.setItem(String(e),JSON.stringify(t))}function Qt(e){let t=localStorage.getItem(String(e));return t?JSON.parse(t):{}}var Q={save:Gt,find:Qt};var X="TurboBoost::State",Z={pages:{},signed:null,unsigned:{}},Y=null,te={},V=()=>{let e=s(s({},Z),Q.find(X));Y=e.signed,te=U(e.unsigned),e.pages[location.pathname]=e.pages[location.pathname]||{},G.restoreState(e.pages[location.pathname])},W=()=>{let e=s(s({},Z),Q.find(X)),t={signed:Y||e.signed,unsigned:s(s({},e.unsigned),te),pages:s({},e.pages)},r=location.pathname,n=G.buildState();Object.values(n).length?t.pages[r]=n:delete t.pages[r],Q.save(X,t)},Yt=e=>{let t=s(s({},Z),JSON.parse(e));Y=t.signed,te=U(t.unsigned),W(),u(v.stateInitialize,document,{detail:te})};addEventListener("DOMContentLoaded",V);addEventListener("turbo:morph",V);addEventListener("turbo:render",V);addEventListener("turbo:before-fetch-request",W);addEventListener("beforeunload",W);var re={initialize:Yt,buildPageState:G.buildState,get signed(){return Y},get unsigned(){return te}};function Zt(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}var ne={v4:Zt};var oe="0.3.2";var ae=self.TurboBoost||{},ie={VERSION:oe,active:!1,confirmation:A,logger:F,schema:f,events:b,registerEventDelegate:O.register,get eventDelegates(){return O.events}};function ct(e,t){var r;return{csrfToken:(r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"),id:e,name:t.getAttribute(f.commandAttribute),elementId:t.id.length?t.id:null,elementAttributes:C.buildAttributePayload(t),startedAt:Date.now(),state:{page:re.buildPageState(),signed:re.signed,unsigned:re.unsigned}}}async function ee(e){let t,r={};try{if(t=C.findClosestCommand(e.target),!t||!O.isRegisteredForElement(e.type,t))return;let r=ne.v4(),n=I.find(t),o=p(s({},ct(r,t)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),a=await u(b.start,t,{cancelable:!0,detail:o});if(a.defaultPrevented||a.detail.confirmation&&e.defaultPrevented)return u(b.abort,t,{detail:{message:`An event handler for '${b.start}' prevented default behavior and blocked command invocation!`,source:a}});switch(n=I.find(t),o=p(s({},ct(r,t)),{driver:n.name,frameId:n.frame?n.frame.id:null,src:n.src}),h.add(o),["frame","window"].includes(n.name)&&e.preventDefault(),n.name){case"method":return n.invokeCommand(t,o);case"form":return n.invokeCommand(t,o,e);case"frame":return n.invokeCommand(n.frame,o);case"window":return n.invokeCommand(self,o)}}catch(e){u(b.clientError,t,{detail:p(s({},r),{error:e})})}}self.TurboBoost=s({},ae);self.TurboBoost.Commands||(O.handler=ee,O.register("click",[`[${f.commandAttribute}]`]),O.register("submit",[`form[${f.commandAttribute}]`]),O.register("toggle",[`details[${f.commandAttribute}]`]),O.register("change",[`input[${f.commandAttribute}]`,`select[${f.commandAttribute}]`,`textarea[${f.commandAttribute}]`]),self.TurboBoost.Commands=ie,self.TurboBoost.State={initialize:re.initialize,get current(){return re.unsigned}});var se=ie;export{se as default};

